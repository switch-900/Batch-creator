<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitmap Parcel Command Generator</title>
    <style>
        /* Reset some default styles */
        body, h2, h3, table, th, td, input, button, label {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Body Styling */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1e1e1e;
            color: #f0f0f0;
            padding: 20px;
        }

        /* Header Styling */
        h2, h3 {
            color: #ff8c00; /* Dark Orange */
            margin-bottom: 15px;
        }

        /* Form Styling */
        form {
            background-color: #2e2e2e;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        label {
            display: block;
            margin-top: 15px;
            font-weight: bold;
            color: #ffa500; /* Orange */
        }

        input[type="text"] {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            border: 1px solid #ff8c00;
            border-radius: 4px;
            background-color: #3e3e3e;
            color: #f0f0f0;
        }

        /* Checkbox Group Styling */
        .checkbox-group {
            margin-top: 10px;
            display: flex;
            flex-wrap: wrap;
        }

        .checkbox-group label {
            margin-right: 15px;
            font-weight: normal;
            color: #f0f0f0;
        }

        /* Table Styling */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background-color: #2e2e2e;
            border-radius: 8px;
            overflow: hidden;
        }

        th, td {
            padding: 12px;
            border-bottom: 1px solid #ff8c00;
            text-align: left;
        }

        th {
            background-color: #ff8c00;
            color: #1e1e1e;
        }

        tr:hover {
            background-color: #3e3e3e;
        }

        /* Button Styling */
        button {
            margin-top: 20px;
            padding: 12px 25px;
            background-color: #ff8c00;
            border: none;
            border-radius: 4px;
            color: #1e1e1e;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #ffa500;
        }

        /* Output Sections Styling */
        pre {
            background-color: #2e2e2e;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            color: #f0f0f0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            th, td {
                padding: 8px;
            }

            button {
                width: 100%;
            }
        }

        /* Parcel Count Styling */
        #parcelCount {
            margin-top: 15px;
            font-size: 16px;
            color: #ffa500; /* Orange */
        }
    </style>
</head>
<body>

<h2>Bitmap Parcel Command Generator</h2>

<form id="parcelForm">
    <label for="parent">Parent Inscription ID:</label>
    <input type="text" id="parent" placeholder="Enter parent inscription ID" required>

    <label for="bitmapNumber">Bitmap Number:</label>
    <input type="text" id="bitmapNumber" placeholder="Enter bitmap number, e.g., 123" required>

    <label for="parcelSequence">Parcel Sequence:</label>
    <input type="text" id="parcelSequence" placeholder="Enter parcel sequence, e.g., 35359" required>

    <label for="feeRate">Fee Rate:</label>
    <input type="text" id="feeRate" placeholder="Enter fee rate, e.g., 2" required>

    <label>Deselect Parcel Numbers:</label>
    <div class="checkbox-group" id="parcelFilters">
        <!-- Checkbox inputs for filtering numbers 0-9 will be generated by JavaScript -->
    </div>

    <button type="button" onclick="generateTable()">Generate Parcel Table</button>
</form>

<!-- Display Parcel Count -->
<div id="parcelCount"></div>

<h3>Generated Parcel Table</h3>
<div id="parcelTableContainer"></div>

<h3>YAML Configuration - Ensure you check your yaml</h3>
<pre id="yamlOutput">mode: separate-outputs
parent: ENTER_PARENT_ID
postage: 546
inscriptions:
</pre>
<h3>Commands to Create Files</h3>
<pre id="parcelCommands"></pre>
<button type="button" onclick="copyToClipboard('parcelCommands')">Copy Commands</button>

<h3>Commands to Delete Files</h3>
<pre id="deleteCommands"></pre>
<button type="button" onclick="copyToClipboard('deleteCommands')">Copy Delete Commands</button>

<h3>Final Command</h3>
<pre id="finalCommand"></pre>
<button type="button" onclick="copyToClipboard('finalCommand')">Copy Final Command</button>

<script>
function generateTable() {
    const parent = document.getElementById("parent").value.trim();
    const bitmapNumber = document.getElementById("bitmapNumber").value.trim();
    const parcelSequence = document.getElementById("parcelSequence").value.trim();
    const deselectedParcels = Array.from(document.querySelectorAll('#parcelFilters input[type="checkbox"]:checked')).map(cb => cb.value);

    // Basic validation
    if (!parent || !bitmapNumber || !parcelSequence) {
        alert("Please fill in all required fields.");
        return;
    }

    const tableContainer = document.getElementById("parcelTableContainer");
    tableContainer.innerHTML = ""; // Clear any existing table

    let tableHTML = `<table><tr><th>File</th><th>Parcel Number</th><th>Destination Address (Optional)</th></tr>`;
    let parcelCount = 0; // Initialize parcel count

    // Generate table rows based on parcel sequence
    for (let i = 0; i < parcelSequence.length; i++) {
        const parcel = parcelSequence[i];

        // If the parcel is not deselected, add row
        if (!deselectedParcels.includes(parcel)) {
            const fileName = `${i}${bitmapNumber}bitmap.txt`;
            parcelCount++; // Increment parcel count

            tableHTML += `
                <tr>
                    <td>${fileName}</td>
                    <td>${parcel}</td>
                    <td><input type="text" id="destination-${i}" placeholder="Enter destination address"></td>
                </tr>
            `;
        }
    }

    tableHTML += `</table>`;
    tableContainer.innerHTML = tableHTML;

    // Display parcel count
    document.getElementById("parcelCount").textContent = `Number of parcels being created: ${parcelCount}`;

    // Add Generate YAML and Commands button
    tableContainer.innerHTML += `<button type="button" onclick="generateYamlAndCommands()">Generate YAML and Commands</button>`;
}

function generateYamlAndCommands() {
    const parent = document.getElementById("parent").value.trim();
    const bitmapNumber = document.getElementById("bitmapNumber").value.trim();
    const parcelSequence = document.getElementById("parcelSequence").value.trim();
    const feeRate = document.getElementById("feeRate").value.trim();
    const deselectedParcels = Array.from(document.querySelectorAll('#parcelFilters input[type="checkbox"]:checked')).map(cb => cb.value);

    // Basic validation
    if (!parent || !bitmapNumber || !parcelSequence || !feeRate) {
        alert("Please fill in all required fields.");
        return;
    }

    // // const totalFees = feeRate * parcelCount;

    let yamlContent = `mode: separate-outputs\nparent: ${parent}\npostage: 546\ninscriptions:\n`;
    let parcelCommands = '';

    // Generate YAML and commands based on table data
    for (let i = 0; i < parcelSequence.length; i++) {
        const parcel = parcelSequence[i];

        if (!deselectedParcels.includes(parcel)) {
            const fileName = `${i}${bitmapNumber}bitmap.txt`;
            const bitmapValue = `${i}.${bitmapNumber}.bitmap`;
            const destinationInput = document.getElementById(`destination-${i}`);
            const destination = destinationInput && destinationInput.value.trim() ? `    destination: ${destinationInput.value.trim()}\n` : '';

            // Generate the command
            parcelCommands += `echo '${bitmapValue}' >> ${fileName}\n`;

            // Generate the YAML entry
            yamlContent += `  - file: ${fileName}\n${destination}`;
        }
    }

    // Generate delete commands
    let deleteCommands = '';
    for (let i = 0; i < parcelSequence.length; i++) {
        const parcel = parcelSequence[i];
        if (!deselectedParcels.includes(parcel)) {
            const fileName = `${i}${bitmapNumber}bitmap.txt`;
            deleteCommands += `rm ${fileName}\n`;
        }
    }

    // Add YAML file to delete commands
    deleteCommands += `rm ${bitmapNumber}.yaml\n`;

    // Generate echo command for YAML file
    parcelCommands += `echo "${yamlContent.replace(/\n/g, '\\n')}" > ${bitmapNumber}.yaml\n`;

    // Generate final command
    const finalCmd = `ord wallet batch --fee-rate ${feeRate} --batch ${bitmapNumber}.yaml`;

    // Display the YAML output and commands
    document.getElementById("yamlOutput").textContent = yamlContent;
    document.getElementById("parcelCommands").textContent = parcelCommands;
    document.getElementById("deleteCommands").textContent = deleteCommands;
    document.getElementById("finalCommand").textContent = finalCmd;
}

function copyToClipboard(elementId) {
    const text = document.getElementById(elementId).innerText;
    navigator.clipboard.writeText(text).then(() => {
        alert('Copied to clipboard!');
    }).catch(err => {
        alert('Failed to copy!');
    });
}

// Generate checkboxes for deselecting parcel numbers 0-9
function generateCheckboxes() {
    const parcelFiltersDiv = document.getElementById("parcelFilters");
    for (let i = 0; i <= 9; i++) {
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.id = `filter-${i}`;
        checkbox.value = `${i}`;

        const label = document.createElement("label");
        label.htmlFor = `filter-${i}`;
        label.textContent = i;

        parcelFiltersDiv.appendChild(checkbox);
        parcelFiltersDiv.appendChild(label);
    }
}

// Initialize checkboxes on page load
generateCheckboxes();
</script>

</body>
</html>
